<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Preslik</title>
	<link href="https://rawgit.com/LPology/Simple-Ajax-Uploader/master/examples/assets/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://rawgit.com/LPology/Simple-Ajax-Uploader/master/examples/assets/css/styles.css" rel="stylesheet">
</head>
<body>
	<div class="container">
		<div class="page-header">
			<h1>Preslik</h1>
			<!--
			<h3>
				Pretraga na temelju slike:
				predajte sliku proizvoda i mi otkrivamo gdje ga mo≈æete nabaviti.
			</h3>
			-->
		</div>
		<div class="row" style="padding-top:10px;">
			<div class="col-xs-2">
				<button id="uploadBtn" class="btn btn-large btn-primary">Choose Image</button>
			</div>
			<div class="col-xs-10">
				<div id="progressOuter" class="progress progress-striped active" style="display:none;">
					<div id="progressBar" class="progress-bar progress-bar-success"  role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
					</div>
				</div>
			</div>
		</div>
		<div class="row" style="padding-top:10px;">
			<div class="col-xs-10">
				<div id="msgBox">
				</div>
			</div>
		</div>
		<div class="row" style="padding-top:10px;">
			<div class="col-xs-10">
				<div id="rsltBox">
				</div>
			</div>
		</div>
	</div>

<script src="https://rawgit.com/LPology/Simple-Ajax-Uploader/master/SimpleAjaxUploader.min.js"></script>
<script>
function escapeTags( str ) {
	return String( str )
		.replace( /&/g, '&amp;' )
		.replace( /"/g, '&quot;' )
		.replace( /'/g, '&#39;' )
		.replace( /</g, '&lt;' )
		.replace( />/g, '&gt;' );
}

window.onload = function() {
	//
	var btn = document.getElementById('uploadBtn'),
		progressBar = document.getElementById('progressBar'),
		progressOuter = document.getElementById('progressOuter'),
		msgBox = document.getElementById('msgBox');
		rsltBox = document.getElementById('rsltBox');

	var uploader = new ss.SimpleUpload({
		button: btn,
		url: 'https://138.68.91.60:8080/upload',
		name: 'uploadfile',
		multipart: true,
		maxSize: 8192,
		allowedExtensions: ["jpg", "jpeg", "png"],
		hoverClass: 'hover',
		focusClass: 'focus',
		startXHR: function() {
			progressOuter.style.display = 'block'; // make progress bar visible
			this.setProgressBar( progressBar );
		},
		onSubmit: function() {
			msgBox.innerHTML = ''; // empty the message box
			btn.innerHTML = 'Uploading ...'; // change button text to "Uploading..."
		},
		onComplete: function( filename, response ) {
			btn.innerHTML = 'Choose Another Image';
			progressOuter.style.display = 'none'; // hide progress bar when upload is completed

			if(!response) {
				msgBox.innerHTML = 'Unable to upload file.';
				return;
			}

			//
			var data = JSON.parse(response);
			var string = ''
			if(data.status === 1) {
				//
				for(var i=0; i<data.results.length; ++i)
				{
					string = string + '<img src="' + data.results[i].imgurl + '" alt="retrieved image" style="max-width:256px;max-height:256px"></br>\n'
					string = string + '<a href="' + data.results[i].url + '">' + data.results[i].info + '</a></br><hr>\n'
				}
				//
				msgBox.innerHTML = '<strong>' + escapeTags( filename ) + '</strong>' + ' successfully uploaded.';
				rsltBox.innerHTML = string
			}
			else
				msgBox.innerHTML = '<strong>' + data.message + '</strong>'
		},
		onError: function(filename, errorType, status, statusText, response, uploadBtn, fileSize) {
			progressOuter.style.display = 'none';
			msgBox.innerHTML = 'Unable to upload file. (' + errorType + ')';
		}
	});
};
</script>
</body>
</html>
